# [SPARQL](https://www.w3.org/TR/rdf-sparql-query/) for [langchain](https://github.com/hwchase17/langchain)
langchain support for knowledge graphs relying on W3C standards using RDFlib: SPARQL/ RDF(S)/ OWL; for now, I focused on RDF \
* Works with local files, files from the web, and SPARQL endpoints
* Supports both SELECT and UPDATE queries

## Related PRs and discussions
* [Wikibase agent](https://github.com/hwchase17/langchain/pull/2690) - uses SPARQL specifically for wikibase querying
* [Cypher qa](https://github.com/hwchase17/langchain/pull/5078) - graph DB question answering for Neo4J
* Discussions on [w3c mailing list](mailto:semantic-web@w3.org) related to the combination of LLMs (specifically ChatGPT) and knowledge graphs
* [PR 6050](https://github.com/hwchase17/langchain/pull/6050) - tries something similar, but does not cover UPDATE queries

## Gap
* No generic SPARQL QA support for graph databases relying on W3C standards
* Wrapping this functionality in a chain makes more sense than in an agent - allows combining several data sources





# personal notes

## ideas
* generate SPARQL for NL questions
* validate SPARQL - rerun otherwise (set a max for reruns, like 3 times) - only makes sense if temp != 0
  * rdflib parser
  * [this](http://sparql.org/sparql.html)
  * [Jena SPARQL validator](http://sparql.org/query-validator.html)
* SPARQL update (insert) for KG construction
* query against generic triple store

## todos/ steps
* langchain for SPARQL QA analogously to Cypher: `langchain/chains/graph_qa/cypher.py`
* validate SPARQL - [RDFlib SPARQL parser](https://rdflib.readthedocs.io/en/stable/_modules/rdflib/plugins/sparql/parser.html) - `rdflib.plugins.sparql.parser.parseQuery(q)`
* agent for SPARQL update
* add jupyter notebook w example
* check [contribution rules](https://github.com/hwchase17/langchain/blob/master/.github/CONTRIBUTING.md) and run tests

## relevant directories
* [class for wrapping the graph, provides connection](https://github.com/hwchase17/langchain/tree/master/langchain/graphs)
* [actual QA, including prompts and chain](https://github.com/hwchase17/langchain/tree/master/langchain/chains/graph_qa)
* [docs - jupyter example](https://github.com/hwchase17/langchain/tree/master/docs/modules/chains/examples)
* [test](https://github.com/hwchase17/langchain/tree/master/tests/integration_tests/chains)

## resources
* [RDF](https://www.w3.org/1999/02/22-rdf-syntax-ns#)
* [RDFS](https://www.w3.org/2000/01/rdf-schema#)
* [OWL](https://www.w3.org/2002/07/owl#)
* [OWL cheat sheet](https://www.w3.org/2007/OWL/refcardA4)



# todos
* find or create dedicated examples for RDF/ RDFS/ OWL - make publicly available, create locally for tests
* find or create example for triple store use
* additional tests, also for update queries - properly handle modes
* create jupyter example
* test with one shot prompting - add SPARQL examples
* sparql validation - possibly rerun


# my notes
* [RDFS lecture](https://www.uni-ulm.de/fileadmin/website_uni_ulm/iui.inst.090/Lehre/WS_2011-2012/SemWebGrundlagen/v03_handout.pdf)


