# Cohere

>[Cohere](https://cohere.ai/about) is a Canadian startup that provides natural language processing models
> that help companies improve human-machine interactions.

## Installation and Setup
- Install the Python SDK :
```bash
pip install langchain-cohere
```

Get a [Cohere api key](https://dashboard.cohere.ai/) and set it as an environment variable (`COHERE_API_KEY`)

## Cohere langchain integrations

| API                  | description                      | Endpoint docs                                                           | Import                                                               | Example usage                                                             |
| -------------------- | -------------------------------- | ----------------------------------------------------------------------- | -------------------------------------------------------------------- | ------------------------------------------------------------------------- |
| Chat                 | Build chat bots                  | [chat](https://docs.cohere.com/reference/chat)                          | `from langchain_cohere import ChatCohere`                            | [cohere.ipynb](/docs/docs/integrations/chat/cohere.ipynb)                 |
| LLM                  | Generate text                    | [generate](https://docs.cohere.com/reference/generate)                  | `from langchain_cohere import Cohere`                                | [cohere.ipynb](/docs/docs/integrations/llms/cohere.ipynb)                 |
| RAG Retriever        | Connect to external data sources | [chat + rag](https://docs.cohere.com/reference/chat)                    | `from langchain.retrievers import CohereRagRetriever`                | [cohere.ipynb](/docs/docs/integrations/retrievers/cohere.ipynb)           |
| Text Embedding       | Embed strings to vectors         | [embed](https://docs.cohere.com/reference/embed)                        | `from langchain_cohere import CohereEmbeddings`                      | [cohere.ipynb](/docs/docs/integrations/text_embedding/cohere.ipynb)       |
| Rerank Retriever     | Rank strings based on relevance  | [rerank](https://docs.cohere.com/reference/rerank)                      | `from langchain.retrievers.document_compressors import CohereRerank` | [cohere.ipynb](/docs/docs/integrations/retrievers/cohere-reranker.ipynb)  |
| ReAct Agent          | Multi step tool use              | [Multi Step Tool Use](https://docs.cohere.com/docs/multi-step-tool-use) | `from langchain_cohere import ChatCohere, create_cohere_react_agent` | [multi_hop_agent.ipynb](/libs/partners/cohere/docs/multi_hop_agent.ipynb) |
| Single Step Tool Use | Single step tool use             | [Tool Use](https://docs.cohere.com/docs/tool-use)                       | `from langchain_cohere import ChatCohere, create_cohere_tools_agent` | [cohere_agent.ipynb](/libs/partners/cohere/docs/cohere_agent.ipynb)       |

## Quick copy examples

### Chat

```python
from langchain_cohere import ChatCohere
from langchain_core.messages import HumanMessage
chat = ChatCohere()
messages = [HumanMessage(content="knock knock")]
print(chat(messages))
```

### LLM


```python
from langchain_cohere import Cohere

llm = Cohere(model="command")
print(llm.invoke("Come up with a pet name"))
```

### ReAct Agent

```python
from langchain_community.tools.tavily_search import TavilySearchResults
from langchain_cohere import ChatCohere, create_cohere_react_agent
from langchain.prompts import ChatPromptTemplate
from langchain.agents import AgentExecutor

llm = ChatCohere()

internet_search = TavilySearchResults(max_results=4)
internet_search.name = "internet_search"
internet_search.description = "Route a user query to the internet"

prompt = ChatPromptTemplate.from_template("{input}")

agent = create_cohere_react_agent(
    llm,
    [internet_search],
    prompt
)

agent_executor = AgentExecutor(agent=agent, tools=[internet_search], verbose=True)```

agent_executor.invoke({
    "input": "In what year was the company that was founded as Sound of Music added to the S&P 500?",
})
```

Usage of the [Cohere multi hop agent](/libs/partners/cohere/docs/multi_hop_agent.ipynb) and [more details of multi hop tool use with Cohere](https://docs.cohere.com/docs/tool-use). 

### Single Step Tool Use

```python 
### Router
from typing import Literal

from langchain_core.prompts import ChatPromptTemplate
from langchain_core.pydantic_v1 import BaseModel, Field
from langchain_cohere import ChatCohere

# Data model
class web_search(BaseModel):
    """
    The internet. Use web_search for questions that are related to anything else than agents, prompt engineering, and adversarial attacks.
    """
    query: str = Field(description="The query to use when searching the internet.")

class vectorstore(BaseModel):
    """
    A vectorstore containing documents related to agents, prompt engineering, and adversarial attacks. Use the vectorstore for questions on these topics.
    """
    query: str = Field(description="The query to use when searching the vectorstore.")

# Preamble
preamble = """You are an expert at routing a user question to a vectorstore or web search.
The vectorstore contains documents related to agents, prompt engineering, and adversarial attacks.
Use the vectorstore for questions on these topics. Otherwise, use web-search."""

# LLM with tool use and preamble
llm = ChatCohere()
structured_llm_router = llm.bind_tools(tools=[web_search, vectorstore], preamble=preamble)

# Prompt
route_prompt = ChatPromptTemplate.from_messages(
    [
        ("human", "{question}"),
    ]
)

question_router = route_prompt | structured_llm_router
response = question_router.invoke({"question": "Who will the Bears draft first in the NFL draft?"})
print(response.response_metadata['tool_calls'])
response = question_router.invoke({"question": "What are the types of agent memory?"})
print(response.response_metadata['tool_calls'])
response = question_router.invoke({"question": "Hi how are you?"})
print('tool_calls' in response.response_metadata)
```

Usage of the [Cohere tools agent](/libs/partners/cohere/docs/cohere_agent.ipynb) and [more details of tool use with Cohere](https://docs.cohere.com/docs/tool-use). 

### RAG Retriever

```python
from langchain_cohere import ChatCohere
from langchain.retrievers import CohereRagRetriever
from langchain_core.documents import Document

rag = CohereRagRetriever(llm=ChatCohere())
print(rag.get_relevant_documents("What is cohere ai?"))
```

### Text Embedding

```python
from langchain_cohere import CohereEmbeddings

embeddings = CohereEmbeddings(model="embed-english-light-v3.0")
print(embeddings.embed_documents(["This is a test document."]))
```
